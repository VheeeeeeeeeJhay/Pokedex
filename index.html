<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pokedex</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=search"
    />
  </head>
  <body
    class="flex flex-col justify-center items-center min-h-screen w-screen bg-yellow-400/40 p-4"
  >
    <div class="w-full max-w-4xl">
      <!-- Title -->
      <h1 class="text-center text-4xl sm:text-6xl lg:text-7xl font-bold mb-6">
        <span class="text-red-500">Poke</span
        ><span class="text-white">Search</span>
      </h1>

      <!-- Search form -->
      <!-- Search form -->
      <form
        class="flex flex-col sm:flex-row gap-3 justify-center items-center"
        onsubmit="return searchPokemon(event)"
      >
        <input
          id="pokemon-input"
          type="text"
          class="border border-gray-300 rounded-[20px] p-3 bg-white text-lg sm:text-2xl flex-1 w-full sm:w-auto"
          placeholder="Enter Pokemon name..."
          oninput="this.form.querySelector('button[type=submit]').disabled = this.value.trim() === ''"
        />
        <button
          type="submit"
          class="bg-blue-500 text-white rounded-[20px] px-6 py-3 hover:bg-blue-600 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed"
          disabled
        >
          <span class="material-symbols-outlined text-3xl"> search </span>
        </button>
      </form>

      <!-- Notice -->
      <p
        class="mt-2 text-xs sm:text-sm font-bold text-red-500 text-center px-4"
      >
        *** Notice: When searching for Pokemon, please use the full name, e.g.
        <span class="italic">Pikachu</span>.
      </p>

      <!-- Error message -->
      <div
        id="pokemon-error"
        class="hidden mt-6 mx-auto text-center bg-red-500 text-white rounded-[20px] p-4 max-w-xl"
      >
        <p id="pokemon-error-message" class="text-sm sm:text-base"></p>
      </div>

      <!-- Pokemon card, render after search -->
      <div
        id="pokemon-card"
        class="hidden mt-8 mx-auto bg-white rounded-[20px] flex flex-col max-w-1/3 hover:scale-105 transition duration-300 ease-in-out"
        onClick="toggleModal()"
      >
        <div
          class="flex h-full w-full justify-center items-center rounded-t-[20px] relative p-4"
          id="pokemon-img-container"
        >
          <span
            class="w-[100%] h-[40%] absolute bottom-0 rounded-t-full bg-gray-200/25"
          ></span>
          <p
            id="pokemon-id-bg"
            class="absolute top-0 right-0 font-bold text-white opacity-35 text-[65px] px-4"
          ></p>
          <img
            id="pokemon-img"
            src=""
            alt=""
            class="w-40 h-40 aspect-ratio-1 z-10 object-contain items-center justify-self-center"
          />
        </div>
        <div
          class="text-left space-y-2 z-10 bg-white p-4 rounded-b-[20px] relative flex flex-col justify-center items-center"
        >
          <p id="pokemon-name" class="text-lg sm:text-xl"></p>
          <p id="pokemon-type" class="text-lg sm:text-xl"></p>
        </div>
      </div>

      <!-- Modal -->
      <div
        id="modal"
        class="hidden absolute top-0 left-0 w-full h-full z-50 bg-black/50 flex justify-center items-center"
      >
        <div
          class="h-[50%] w-[50%] bg-white rounded-[20px] relative overflow-hidden"
        >
          <span
            id="pokemon-modal-id-bg"
            class="h-full w-[65%] absolute top-0 left-0"
            style="clip-path: polygon(0% 0%, 100% 0%, 75% 100%, 0% 100%)"
          ></span>

          <div class="flex justify-end relative h-[10%]">
            <!-- modal header -->
            <div class="absolute top-0 right-0">
              <button
                onclick="toggleModal()"
                type="button"
                class="text-white px-6 py-3 flex items-center justify-center"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  height="24px"
                  viewBox="0 -960 960 960"
                  width="24px"
                  fill="red"
                >
                  <path
                    d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"
                  />
                </svg>
              </button>
            </div>
          </div>

          <div class="h-[90%] flex z-10">
            <div class="h-full w-full px-4 line-height-none m-0 relative">
              <p
                id="pokemodal-id"
                class="text-[45px] text-white opacity-70"
              ></p>
              <p
                id="pokemodal-name"
                class="text-md font-semibold text-white tracking-[2px]"
              ></p>
              <div
                class="bg-white/50 rounded-[20px] border border-gray-100 w-25 text-center"
              >
                <p
                  id="pokemodal-type"
                  class="text-md font-semibold text-white tracking-[2px]"
                ></p>
              </div>
              <div class="flex">
                <h3 class="text-md font-bold text-white tracking-[1px]">
                  Weight:/ &nbsp;
                </h3>
                <p
                  id="pokemodal-weight"
                  class="text-md font-semibold text-white tracking-[2px]"
                ></p>
              </div>
              <div class="flex">
                <h3 class="text-md font-bold text-white tracking-[1px]">
                  Height:/ &nbsp;
                </h3>
                <p
                  id="pokemodal-height"
                  class="text-md font-semibold text-white tracking-[2px]"
                ></p>
              </div>
              <div class="flex">
                <h3 class="text-md font-bold text-white tracking-[1px]">
                  Ability:/ &nbsp;
                </h3>
                <p
                  id="pokemodal-ability"
                  class="text-md font-semibold text-white tracking-[2px]"
                ></p>
              </div>

              <div class="relative">
                <p
                  class="text-lg -rotate-90 absolute top-5 -left-5 text-white font-bold"
                >
                  STATS
                </p>
                <div class="flex justify-evenly">
                  <div>
                    <p
                      id="pokemodal-hp"
                      class="text-md text-white font-semibold"
                    ></p>
                    <p
                      id="pokemodal-attack"
                      class="text-md text-white font-semibold"
                    ></p>
                    <p
                      id="pokemodal-defense"
                      class="text-md text-white font-semibold"
                    ></p>
                  </div>
                  <div>
                    <p
                      id="pokemodal-special-attack"
                      class="text-md text-white font-semibold"
                    ></p>
                    <p
                      id="pokemodal-special-defense"
                      class="text-md text-white font-semibold"
                    ></p>
                    <p
                      id="pokemodal-speed"
                      class="text-md text-white font-semibold"
                    ></p>
                  </div>
                </div>
              </div>
            </div>

            <div class="h-full w-full flex justify-center items-center">
              <img
                id="pokemon-modal-img"
                src=""
                alt=""
                class="w-[75%] h-[75%] aspect-ratio-1 z-10 object-contain items-center justify-self-center"
              />
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const typeColors = {
        normal: "bg-gray-400",
        fire: "bg-red-500",
        water: "bg-blue-500",
        electric: "bg-yellow-400",
        grass: "bg-green-500",
        ice: "bg-cyan-300",
        fighting: "bg-orange-700",
        poison: "bg-purple-500",
        ground: "bg-yellow-700",
        flying: "bg-indigo-300",
        psychic: "bg-pink-500",
        bug: "bg-lime-500",
        rock: "bg-stone-500",
        ghost: "bg-violet-700",
        dragon: "bg-indigo-700",
        dark: "bg-gray-800",
        steel: "bg-slate-400",
        fairy: "bg-pink-300",
        stellar: "bg-sky-400",
      };

      const pokemonCard = document.getElementById("pokemon-card");
      const pokemonImgContainer = document.getElementById(
        "pokemon-img-container"
      );

      const pokemonError = document.getElementById("pokemon-error");
      const pokemonErrorMessage = document.getElementById(
        "pokemon-error-message"
      );

      //modal codes
      const pokemonModalIdBg = document.getElementById("pokemon-modal-id-bg");
      const pokeModalId = document.getElementById("pokemodal-id");
      const pokeModalName = document.getElementById("pokemodal-name");
      const pokeModalType = document.getElementById("pokemodal-type");
      const pokeModalWeight = document.getElementById("pokemodal-weight");
      const pokeModalHeight = document.getElementById("pokemodal-height");
      const pokeModalAbility = document.getElementById("pokemodal-ability");
      const pokeModalHp = document.getElementById("pokemodal-hp");
      const pokeModalAttack = document.getElementById("pokemodal-attack");
      const pokeModalDefense = document.getElementById("pokemodal-defense");
      const pokeModalSpecialAttack = document.getElementById(
        "pokemodal-special-attack"
      );
      const pokeModalSpecialDefense = document.getElementById(
        "pokemodal-special-defense"
      );
      const pokeModalSpeed = document.getElementById("pokemodal-speed");

      function searchPokemon(event) {
        event.preventDefault();
        const pokemonName = document
          .querySelector("input")
          .value.toLowerCase()
          .trim();

        fetch(`https://pokeapi.co/api/v2/pokemon/${pokemonName}`)
          .then((response) => response.json())
          .then((data) => {
            const { name, weight, sprites, id, types, height, ability, stats } =
              data;

            // Update image
            const img = document.getElementById("pokemon-img");
            img.src = sprites.front_default;
            img.alt = name;

            const modalImg = document.getElementById("pokemon-modal-img");
            modalImg.src = sprites.front_default;
            modalImg.alt = name;

            // Update text
            document.getElementById("pokemon-id-bg").textContent = `#${id}`;
            document.getElementById("pokemon-name").textContent =
              name[0].toUpperCase() + name.slice(1);
            console.log(document.getElementById("pokemon-name").textContent);
            const pokemonTypes = types.map((t) => t.type.name);

            // Show types
            const typeElement = document.getElementById("pokemon-type");
            typeElement.innerHTML = "";
            pokemonTypes.forEach((typeName) => {
              const typeBadge = document.createElement("span");
              typeBadge.className = `inline-block rounded-full px-3 py-1 text-sm font-semibold text-white mr-2 mb-2 ${
                typeColors[typeName] || "bg-gray-200"
              }`;
              typeBadge.textContent =
                typeName.charAt(0).toUpperCase() + typeName.slice(1);
              typeElement.appendChild(typeBadge);
            });

            // First, clear any existing color classes
            Object.values(typeColors).forEach((colorClass) => {
              pokemonImgContainer.classList.remove(colorClass);
            });
            pokemonImgContainer.classList.remove("bg-gray-200");

            // Then add only the matching color
            const pokemonType = types[0].type.name;
            pokemonImgContainer.classList.add(
              typeColors[pokemonType] || "bg-gray-200"
            );

            // Modal ID background color
            Object.values(typeColors).forEach((colorClass) => {
              pokemonModalIdBg.classList.remove(colorClass);
            });
            pokemonModalIdBg.classList.remove("bg-gray-200");
            const pokemonModalType = types[0].type.name;
            pokemonModalIdBg.classList.add(
              typeColors[pokemonModalType] || "bg-gray-200"
            );
            pokeModalId.textContent = `#${id}`;
            pokeModalName.textContent = name[0].toUpperCase() + name.slice(1);
            pokeModalType.textContent = pokemonTypes.join(", ");
            pokeModalWeight.textContent = weight + " lbs";
            pokeModalHeight.textContent = height + " ft";
            pokeModalAbility.textContent = data.abilities[0].ability.name;
            pokeModalHp.textContent =
              stats[0].stat.name.toUpperCase() + " " + data.stats[0].base_stat;
            pokeModalAttack.textContent =
              stats[1].stat.name.toUpperCase() + " " + data.stats[1].base_stat;
            pokeModalDefense.textContent =
              stats[2].stat.name.toUpperCase() + " " + data.stats[2].base_stat;
            pokeModalSpecialAttack.textContent =
              stats[3].stat.name.toUpperCase() + " " + data.stats[3].base_stat;
            pokeModalSpecialDefense.textContent =
              stats[4].stat.name.toUpperCase() + " " + data.stats[4].base_stat;
            pokeModalSpeed.textContent =
              stats[5].stat.name.toUpperCase() + " " + data.stats[5].base_stat;

            pokemonCard.classList.remove("hidden");
            pokemonError.classList.add("hidden");
          })
          .catch((error) => {
            pokemonCard.classList.add("hidden");
            pokemonError.classList.remove("hidden");
            pokemonErrorMessage.textContent = `Pokemon "${pokemonName}" not found!`;
            setTimeout(() => {
              pokemonError.classList.add("hidden");
            }, 6000);
          });
      }

      let modalStatus = false;
      function toggleModal() {
        const modal = document.getElementById("modal");
        if (modalStatus === true) {
          modal.classList.add("hidden");
        } else {
          modal.classList.remove("hidden");
        }

        console.log("Modal opened");
        modalStatus = !modalStatus;
        console.log(modalStatus);
      }
      window.onclick = (event) => {
        // if you click directly on the overlay (not inside the modal body)
        if (event.target === modal) {
          modal.classList.add("hidden");
          modalStatus = false;
          console.log("Modal closed, status: " + modalStatus);
        }
      };
    </script>
  </body>
</html>